<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body { font-family: Arial, sans-serif; margin: 0 auto; padding: 0; width: 1200px; box-sizing: border-box; }
      .banner { background-color: #007bff; color: white; text-align: center; padding: 15px 0; font-size: 18px; font-weight: bold; }
      .separator-line { border-bottom: 1px solid #ccc; margin: 0; }
      .header-container { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; background-color: #f2f2f2; }
      .search-container { display: flex; align-items: center; background-color: #f1f1f1; border: 1px solid #ccc; border-radius: 5px; overflow: hidden; }
      #searchInput { border: none; padding: 8px; width: 200px; outline: none; background-color: transparent; box-sizing: border-box; }
      .search-button { background-color: transparent; border: none; padding: 8px; cursor: pointer; color: #007bff; }
      .location-select { border: none; background-color: transparent; padding: 8px; margin-left: 10px; color: #333; cursor: pointer; box-sizing: border-box; }
      .clock { font-size: 16px; color: #333; }
      .marquee-container { background-color: #e9ecef; padding: 5px 0; overflow: hidden; }
      .marquee { white-space: nowrap; overflow: hidden; animation: marquee 15s linear infinite; color: #dc3545; }
      @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
      .nav-container { padding: 10px 20px; background-color: #f8f9fa; }
      .nav-links a { margin-right: 20px; text-decoration: none; color: #007bff; font-weight: bold; }
      .nav-links a:hover { text-decoration: underline; }
      .tabs { margin-bottom: 20px; }
      .tab-button { padding: 10px 20px; margin-right: 5px; background-color: #f2f2f2; border: none; cursor: pointer; }
      .tab-button.active { background-color: #4CAF50; color: white; }
      .tab-content { display: none; }
      .tab-content.active { display: block; }
      table { border-collapse: collapse; width: 100%; }
      th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
      th { background-color: #f2f2f2; }
      .form-group { margin-bottom: 15px; }
      button { padding: 10px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
      button:hover { background-color: #45a049; }
      input[type="date"], input[type="text"] { padding: 8px; }
      .error { color: red; }
      .document-card { border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 5px; background-color: #f9f9f9; position: relative; }
      .document-card .number { position: absolute; top: 10px; left: 10px; background: #007bff; color: white; border-radius: 50%; width: 24px; height: 24px; text-align: center; line-height: 24px; }
      .document-card .title { font-weight: bold; margin: 5px 0; }
      .document-card .date { color: #666; }
      .document-card .status { color: #888; }
      .document-card .actions { margin-top: 10px; }
      .document-card .actions button { padding: 5px 10px; margin-right: 5px; background-color: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
      .document-card .actions button:hover { background-color: #0056b3; }
      .pdf-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
      .pdf-modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; padding: 20px; width: 80%; height: 80%; }
      .pdf-modal-content iframe { width: 100%; height: 100%; border: none; }
      .pdf-modal-close { position: absolute; top: 10px; right: 10px; font-size: 20px; cursor: pointer; }
      .detail-container { padding: 20px; background-color: #fff; border: 1px solid #ddd; border-radius: 5px; }
      .detail-container h2 { margin-top: 0; color: #007bff; }
      .detail-container p { margin: 10px 0; }
      .detail-container .label { font-weight: bold; }
      .detail-container .back-button { margin-top: 20px; background-color: #6c757d; }
      .detail-container .back-button:hover { background-color: #5a6268; }
      @media (max-width: 1200px) {
        body { width: 100%; padding: 0 10px; }
        .header-container { flex-direction: column; gap: 10px; }
        .search-container { width: 100%; }
        #searchInput { width: 70%; }
        .location-select { width: 30%; margin-left: 0; }
        .nav-links a { margin-right: 10px; }
        .document-card .number { top: 5px; left: 5px; width: 20px; height: 20px; line-height: 20px; }
      }
      @media (max-width: 768px) {
        .banner { font-size: 16px; padding: 10px 0; }
        .header-container { padding: 5px 10px; }
        #searchInput { width: 60%; }
        .location-select { width: 40%; }
        .clock { font-size: 14px; }
        .nav-links a { margin-right: 5px; }
        .tab-button { padding: 8px 15px; font-size: 14px; }
      }
      @media (max-width: 480px) {
        .banner { font-size: 14px; padding: 8px 0; }
        .header-container { padding: 5px; }
        .search-container { flex-direction: column; width: 100%; }
        #searchInput { width: 100%; margin-bottom: 5px; }
        .location-select { width: 100%; margin-left: 0; margin-top: 5px; }
        .clock { font-size: 12px; text-align: center; margin-top: 5px; }
        .nav-links { flex-direction: column; align-items: center; }
        .nav-links a { margin: 5px 0; }
        .tab-button { padding: 6px 12px; font-size: 12px; margin: 2px; }
        .document-card .actions { flex-direction: column; }
        .document-card .actions button { width: 100%; margin: 5px 0; }
      }
    </style>
  </head>
  <body>
    <div class="banner">
      H·ªÜ TH·ªêNG VƒÇN B·∫¢N PH√ÅP L√ù<br>
      PH·ª§C V·ª§ C√îNG T√ÅC D·ª∞ B√ÅO TH·ªä TR∆Ø·ªúNG LAO ƒê·ªòNG<br>
      T·∫†I TH√ÄNH PH·ªê H·ªí CH√ç MINH
    </div>
    <hr class="separator-line">
    <div class="header-container">
      <div class="search-container">
        <input type="text" id="searchInput" placeholder="Nh·∫≠p t·ª´ kh√≥a" onkeypress="if(event.key === 'Enter') searchData();">
        <button class="search-button" onclick="searchData()">üîç</button>
        <select class="location-select" onchange="updateWeather()">
          <option value="H√† N·ªôi, 27¬∞ - 29¬∞">H√† N·ªôi, 27¬∞ - 29¬∞</option>
          <option value="TP.HCM, 28¬∞ - 32¬∞">TP.HCM, 28¬∞ - 32¬∞</option>
          <option value="ƒê√† N·∫µng, 26¬∞ - 30¬∞">ƒê√† N·∫µng, 26¬∞ - 30¬∞</option>
        </select>
      </div>
      <div class="clock" id="clock"></div>
    </div>
    <div class="marquee-container">
      <div class="marquee">
        üöÄ Th·ªß t∆∞·ªõng Ph·∫°m Minh Ch√≠nh thƒÉm ch√≠nh th·ª©c Malaysia, d·ª± H·ªôi ngh·ªã C·∫•p cao ASEAN l·∫ßn th·ª© 46 üöÄ S·ª≠a ƒë·ªïi, b·ªï sung m·ªôt s·ªë ƒëi·ªÅu c·ªßa Hi·∫øn ph√°p nƒÉm 20...
      </div>
    </div>
    <div class="nav-container">
      <div class="nav-links">
        <a href="#" onclick="openTab('tableView')">Trang ch·ªß</a>
        <a href="#" onclick="openTab('divView')">H·ªá th·ªëng vƒÉn b·∫£n</a>
      </div>
    </div>
    <div class="tabs">
      <button class="tab-button active" onclick="openTab('tableView')">Danh s√°ch (B·∫£ng)</button>
      <button class="tab-button" onclick="openTab('divView')">Danh s√°ch (Div)</button>
      <button class="tab-button" onclick="openTab('addDocument')">Th√™m VƒÉn b·∫£n</button>
    </div>

    <div id="tableView" class="tab-content active">
      <table id="dataTable">
        <thead><tr id="headerRow"></tr></thead>
        <tbody id="dataBody"></tbody>
      </table>
      <div id="errorMessage" class="error"></div>
    </div>

    <div id="divView" class="tab-content">
      <div id="documentsContainer"></div>
      <div id="errorMessageDiv" class="error"></div>
    </div>

    <div id="addDocument" class="tab-content">
      <h3>Th√™m VƒÉn b·∫£n M·ªõi</h3>
      <div class="form-group">
        <label>S·ªë/k√Ω hi·ªáu:</label><input type="text" id="inputSoKyHieu">
      </div>
      <div class="form-group">
        <label>Tr√≠ch y·∫øu:</label><input type="text" id="inputTrichYeu">
      </div>
      <div class="form-group">
        <label>C∆° quan ban h√†nh:</label><input type="text" id="inputCoQuan">
      </div>
      <div class="form-group">
        <label>Ng√†y ban h√†nh:</label><input type="date" id="inputNgayBanHanh">
      </div>
      <div class="form-group">
        <label>Google Drive PDF URL:</label><input type="text" id="inputPdfUrl" placeholder="D√°n URL Google Drive c√¥ng khai">
      </div>
      <button onclick="submitData()">Submit</button>
    </div>

    <div id="detailView" class="tab-content">
      <div class="detail-container">
        <h2>Chi ti·∫øt VƒÉn b·∫£n</h2>
        <p><span class="label">S·ªë/k√Ω hi·ªáu:</span> <span id="detailSoKyHieu"></span></p>
        <p><span class="label">Tr√≠ch y·∫øu:</span> <span id="detailTrichYeu"></span></p>
        <p><span class="label">C∆° quan ban h√†nh:</span> <span id="detailCoQuan"></span></p>
        <p><span class="label">Ng√†y ban h√†nh:</span> <span id="detailNgayBanHanh"></span></p>
        <p><span class="label">PDF URL:</span> <a id="detailPdfUrl" href="#" target="_blank">Xem PDF</a></p>
        <button class="back-button" onclick="openTab('divView')">Quay l·∫°i</button>
      </div>
    </div>

    <div id="pdfModal" class="pdf-modal">
      <div class="pdf-modal-content">
        <span class="pdf-modal-close" onclick="closePdfModal()">√ó</span>
        <iframe id="pdfFrame"></iframe>
      </div>
    </div>

    <script>
      let allData = [];
      let currentDocumentIndex = null;

      function getDataCallback(data) {
        if (typeof data === 'string' && data.startsWith('L·ªói')) {
          showError({ message: data });
        } else {
          displayData(data);
        }
      }

      function appendDataCallback(message) {
        alert(message);
        if (!message.startsWith('L·ªói')) {
          loadScript('getData', getDataCallback);
        } else {
          showError({ message });
        }
      }

      function getPdfUrlCallback(pdfUrl) {
        if (pdfUrl && !pdfUrl.startsWith('L·ªói')) {
          const fileId = pdfUrl.match(/[-\w]{25,}/)?.[0];
          if (fileId) {
            const embedUrl = `https://drive.google.com/file/d/${fileId}/preview`;
            document.getElementById('pdfFrame').src = embedUrl;
            document.getElementById('pdfModal').style.display = 'block';
          } else {
            alert('URL PDF kh√¥ng h·ª£p l·ªá!');
          }
        } else {
          alert('Kh√¥ng t√¨m th·∫•y URL PDF ho·∫∑c ' + pdfUrl);
        }
      }

      function loadScript(action, callback, params = {}) {
        console.log('G·ª≠i JSONP:', { action, params });
        const script = document.createElement('script');
        const url = new URL('https://script.google.com/macros/s/AKfycbz8WODqQ_ahIzDeH65Nu2LLoa74BkTFGrQnnHEB16e6T5_eWM9kq37-sQxMy8GcqxvR/exec');
        url.searchParams.append('callback', callback.name);
        url.searchParams.append('action', action);
        for (const [key, value] of Object.entries(params)) {
          url.searchParams.append(key, value);
        }
        script.src = url.toString();
        console.log('URL JSONP:', script.src);
        document.head.appendChild(script);
        script.onload = () => script.remove();
      }

      loadScript('getData', getDataCallback);

      function updateClock() {
        const now = new Date();
        const options = { hour: '2-digit', minute: '2-digit', hour12: true, timeZone: 'Asia/Ho_Chi_Minh', weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' };
        const formattedTime = now.toLocaleString('en-US', options).replace(',', '');
        document.getElementById('clock').textContent = formattedTime;
      }
      setInterval(updateClock, 1000);
      updateClock();

      function updateWeather() {
        const select = document.querySelector('.location-select');
        const selectedOption = select.options[select.selectedIndex].value;
        console.log('Selected weather:', selectedOption);
      }

      function displayData(data) {
        allData = data || [];
        const errorMessage = document.querySelector('#errorMessage');
        const errorMessageDiv = document.querySelector('#errorMessageDiv');
        errorMessage.innerHTML = '';
        errorMessageDiv.innerHTML = '';

        if (!data || !Array.isArray(data) || data.length <= 1) {
          errorMessage.textContent = 'Kh√¥ng c√≥ d·ªØ li·ªáu trong sheet ho·∫∑c ch·ªâ c√≥ ti√™u ƒë·ªÅ!';
          errorMessageDiv.textContent = 'Kh√¥ng c√≥ d·ªØ li·ªáu trong sheet ho·∫∑c ch·ªâ c√≥ ti√™u ƒë·ªÅ!';
          return;
        }

        if (!data[0] || data[0].length < 5) {
          errorMessage.textContent = `Ti√™u ƒë·ªÅ sheet kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng! C·∫ßn √≠t nh·∫•t 5 c·ªôt: STT, S·ªë/k√Ω hi·ªáu, Tr√≠ch y·∫øu, C∆° quan ban h√†nh, Ng√†y ban h√†nh.`;
          errorMessageDiv.textContent = `Ti√™u ƒë·ªÅ sheet kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng! C·∫ßn √≠t nh·∫•t 5 c·ªôt: STT, S·ªë/k√Ω hi·ªáu, Tr√≠ch y·∫øu, C∆° quan ban h√†nh, Ng√†y ban h√†nh.`;
          return;
        }

        renderTable(allData.slice(1));
        renderDivs(allData.slice(1));
      }

      function renderTable(rows) {
        const headerRow = document.querySelector('#headerRow');
        const dataBody = document.querySelector('#dataBody');
        headerRow.innerHTML = '';
        dataBody.innerHTML = '';

        if (!allData || !Array.isArray(allData) || !allData[0] || !Array.isArray(allData[0])) {
          const tr = document.createElement('tr');
          const td = document.createElement('td');
          td.colSpan = 5;
          td.textContent = 'D·ªØ li·ªáu ch∆∞a s·∫µn s√†ng!';
          tr.appendChild(td);
          dataBody.appendChild(tr);
          return;
        }

        allData[0].forEach(header => {
          const th = document.createElement('th');
          th.textContent = header || '';
          headerRow.appendChild(th);
        });

        if (!rows || !rows.length) {
          const tr = document.createElement('tr');
          const td = document.createElement('td');
          td.colSpan = 5;
          td.textContent = 'Kh√¥ng t√¨m th·∫•y vƒÉn b·∫£n!';
          tr.appendChild(td);
          dataBody.appendChild(tr);
          return;
        }

        rows.forEach((row, index) => {
          const tr = document.createElement('tr');
          row.forEach(cell => {
            const td = document.createElement('td');
            td.textContent = cell || '';
            tr.appendChild(td);
          });
          tr.onclick = () => showDetail(index + 1);
          tr.style.cursor = 'pointer';
          dataBody.appendChild(tr);
        });
      }

      function renderDivs(rows) {
        const container = document.querySelector('#documentsContainer');
        container.innerHTML = '';
        if (!rows || !rows.length) {
          const p = document.createElement('p');
          p.textContent = 'Kh√¥ng t√¨m th·∫•y vƒÉn b·∫£n!';
          container.appendChild(p);
          return;
        }
        rows.forEach((row, index) => {
          const card = document.createElement('div');
          card.className = 'document-card';
          const title = `${row[1] || ''} - ${row[2] || ''}`;
          card.innerHTML = `
            <span class="number">${index + 1}</span>
            <div class="title">${title}</div>
            <div class="date">Ng√†y ban h√†nh: ${row[4] || ''}</div>
            <div class="status">Tr·∫°ng th√°i: Ch∆∞a th√¥ng qua</div>
            <div class="actions">
              <button onclick="showDetail(${index + 1})">Xem</button>
              <button onclick="viewPdf(${index + 1})">Xem PDF</button>
              <button onclick="alert('Ch·ª©c nƒÉng t·∫£i v·ªÅ ch∆∞a ƒë∆∞·ª£c tri·ªÉn khai!')">T·∫£i v·ªÅ</button>
            </div>
          `;
          container.appendChild(card);
        });
      }

      function searchData() {
        const searchTerm = document.querySelector('#searchInput').value.toLowerCase();
        const filteredData = allData.slice(1).filter(row => 
          (row[1] && row[1].toLowerCase().includes(searchTerm)) || 
          (row[2] && row[2].toLowerCase().includes(searchTerm))
        );
        renderTable(filteredData);
        renderDivs(filteredData);
      }

      function submitData() {
        const dateInput = document.querySelector('#inputNgayBanHanh').value;
        let formattedDate = '';
        if (dateInput) {
          const date = new Date(dateInput);
          if (!isNaN(date)) {
            formattedDate = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
          } else {
            alert('Ng√†y ban h√†nh kh√¥ng h·ª£p l·ªá!');
            return;
          }
        }

        const rowData = [
          document.querySelector('#inputSoKyHieu').value,
          document.querySelector('#inputTrichYeu').value,
          document.querySelector('#inputCoQuan').value,
          formattedDate,
          document.querySelector('#inputPdfUrl').value.trim()
        ];
        if (rowData.some(field => !field)) {
          alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß c√°c tr∆∞·ªùng!');
          return;
        }
        loadScript('appendData', appendDataCallback, { data: JSON.stringify(rowData) });
      }

      function showError(error) {
        document.querySelector('#errorMessage').textContent = 'L·ªói: ' + (error.message || 'Kh√¥ng x√°c ƒë·ªãnh');
        document.querySelector('#errorMessageDiv').textContent = 'L·ªói: ' + (error.message || 'Kh√¥ng x√°c ƒë·ªãnh');
      }

      function openTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
        document.querySelector(`#${tabId}`).classList.add('active');
        document.querySelector(`[onclick="openTab('${tabId}')"]`)?.classList.add('active');
        if (tabId === 'tableView') {
          if (allData && allData.length > 0) {
            renderTable(allData.slice(1));
          } else {
            renderTable([]);
          }
        } else if (tabId === 'divView') {
          if (allData && allData.length > 0) {
            renderDivs(allData.slice(1));
          } else {
            renderDivs([]);
          }
        }
      }

      function showDetail(index) {
        currentDocumentIndex = index;
        if (allData && allData[index]) {
          const row = allData[index];
          document.getElementById('detailSoKyHieu').textContent = row[1] || '';
          document.getElementById('detailTrichYeu').textContent = row[2] || '';
          document.getElementById('detailCoQuan').textContent = row[3] || '';
          document.getElementById('detailNgayBanHanh').textContent = row[4] || '';
          const pdfUrl = row[5] || '';
          const pdfLink = document.getElementById('detailPdfUrl');
          pdfLink.href = pdfUrl;
          pdfLink.textContent = pdfUrl ? 'Xem PDF' : 'Kh√¥ng c√≥ PDF';
          openTab('detailView');
        } else {
          alert('Kh√¥ng t√¨m th·∫•y th√¥ng tin vƒÉn b·∫£n!');
        }
      }

      function viewPdf(rowIndex) {
        loadScript('getPdfUrl', getPdfUrlCallback, { rowIndex: rowIndex - 1 });
      }

      function closePdfModal() {
        document.getElementById('pdfModal').style.display = 'none';
        document.getElementById('pdfFrame').src = '';
      }
    </script>
  </body>
</html>
